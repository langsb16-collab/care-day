<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µì§€ ìƒì„¸ - CASHiQ ë‡Œì§ˆí™˜ì¼€ì–´</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ§ </text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="font-sans bg-gray-50">
    
    <!-- Navigation -->
    <nav class="bg-white shadow-lg fixed w-full top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-2">
                <div class="flex items-center space-x-1">
                    <span class="text-base md:text-xl">ğŸ§ </span>
                    <h1 class="text-[10px] md:text-xs font-bold text-blue-600 whitespace-nowrap">ë‡Œì§ˆí™˜ì¼€ì–´</h1>
                </div>
                <a href="index.html" class="text-sm md:text-base text-blue-600 hover:text-blue-800">
                    <i class="fas fa-arrow-left mr-1"></i>ëª©ë¡ìœ¼ë¡œ
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="pt-24 pb-16">
        <div class="container mx-auto px-4 max-w-4xl">
            <!-- Notice Header -->
            <div id="noticeHeader" class="bg-white rounded-2xl shadow-xl p-6 md:p-8 mb-6">
                <!-- Will be populated by JavaScript -->
            </div>

            <!-- Notice Content -->
            <div id="noticeContent" class="bg-white rounded-2xl shadow-xl p-6 md:p-8">
                <!-- Will be populated by JavaScript -->
            </div>

            <!-- Navigation Buttons -->
            <div class="mt-8 flex gap-4">
                <a href="index.html" class="flex-1 bg-gray-600 text-white py-3 rounded-lg font-semibold hover:bg-gray-700 transition text-center">
                    <i class="fas fa-list mr-2"></i>ëª©ë¡
                </a>
                <button onclick="window.print()" class="px-6 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
                    <i class="fas fa-print mr-2"></i>ì¸ì‡„
                </button>
            </div>
        </div>
    </div>

    <script>
        async function loadNotice() {
            const params = new URLSearchParams(window.location.search);
            const id = parseInt(params.get('id'));

            if (!id) {
                alert('ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.');
                window.location.href = 'index.html';
                return;
            }

            try {
                const saved = localStorage.getItem('notices');
                let notices = [];
                
                if (saved) {
                    notices = JSON.parse(saved);
                } else {
                    const response = await fetch('../data/notices.json');
                    notices = await response.json();
                }

                const notice = notices.find(n => n.id === id);
                
                if (!notice || !notice.active) {
                    alert('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê³µì§€ì‚¬í•­ì…ë‹ˆë‹¤.');
                    window.location.href = 'index.html';
                    return;
                }

                renderNotice(notice);
            } catch (error) {
                console.error('Error loading notice:', error);
                alert('ê³µì§€ì‚¬í•­ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        function renderNotice(notice) {
            document.title = `${notice.title} - CASHiQ ë‡Œì§ˆí™˜ì¼€ì–´`;

            // Header
            document.getElementById('noticeHeader').innerHTML = `
                <div class="flex flex-wrap items-center gap-2 mb-4">
                    ${notice.pinned ? '<span class="px-3 py-1 bg-yellow-100 text-yellow-800 text-sm font-medium rounded-full"><i class="fas fa-thumbtack mr-1"></i>ê³ ì •</span>' : ''}
                    <span class="px-3 py-1 ${getImportanceBadge(notice.importance)} text-sm font-medium rounded-full">
                        ${getImportanceText(notice.importance)}
                    </span>
                    <span class="px-3 py-1 ${getCategoryBadge(notice.category)} text-sm font-medium rounded-full">
                        ${getCategoryText(notice.category)}
                    </span>
                    <span class="text-sm text-gray-500">${getLangIcon(notice.lang)} ${getLangText(notice.lang)}</span>
                </div>
                
                <h1 class="text-2xl md:text-4xl font-bold text-gray-800 mb-4">${notice.title}</h1>
                
                ${notice.summary ? `<p class="text-lg text-gray-600 mb-4">${notice.summary}</p>` : ''}
                
                <div class="flex items-center text-sm text-gray-500 border-t pt-4">
                    <i class="fas fa-calendar-alt mr-2"></i>
                    <span>${formatDate(notice.createdAt)}</span>
                    ${notice.updatedAt && notice.updatedAt !== notice.createdAt ? 
                        `<span class="ml-4"><i class="fas fa-edit mr-2"></i>ìˆ˜ì •: ${formatDate(notice.updatedAt)}</span>` : ''}
                </div>
            `;

            // Content
            let content = `<div class="prose prose-lg max-w-none">`;
            content += `<div class="whitespace-pre-line text-gray-700 leading-relaxed">${notice.content}</div>`;

            if (notice.imageUrl) {
                content += `
                    <div class="my-6">
                        <img src="${notice.imageUrl}" alt="${notice.title}" class="w-full rounded-lg shadow-lg">
                    </div>
                `;
            }

            if (notice.videoUrl) {
                const videoId = notice.videoUrl.includes('youtu.be') ? 
                    notice.videoUrl.split('/').pop() : 
                    notice.videoUrl.split('v=')[1]?.split('&')[0];
                
                if (videoId) {
                    content += `
                        <div class="my-6 aspect-video">
                            <iframe 
                                width="100%" 
                                height="100%" 
                                src="https://www.youtube.com/embed/${videoId}" 
                                frameborder="0" 
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                                allowfullscreen
                                class="rounded-lg shadow-lg"
                            ></iframe>
                        </div>
                    `;
                }
            }

            content += `</div>`;
            document.getElementById('noticeContent').innerHTML = content;
        }

        // Helper functions
        function getImportanceBadge(importance) {
            const badges = {
                normal: 'bg-gray-100 text-gray-800',
                important: 'bg-yellow-100 text-yellow-800',
                urgent: 'bg-red-100 text-red-800'
            };
            return badges[importance] || badges.normal;
        }

        function getImportanceText(importance) {
            const texts = {
                normal: 'ì¼ë°˜',
                important: 'ì¤‘ìš”',
                urgent: 'ê¸´ê¸‰'
            };
            return texts[importance] || importance;
        }

        function getCategoryBadge(category) {
            const badges = {
                service: 'bg-blue-100 text-blue-800',
                maintenance: 'bg-orange-100 text-orange-800',
                event: 'bg-green-100 text-green-800',
                policy: 'bg-purple-100 text-purple-800',
                emergency: 'bg-red-100 text-red-800'
            };
            return badges[category] || 'bg-gray-100 text-gray-800';
        }

        function getCategoryText(category) {
            const texts = {
                service: 'ì„œë¹„ìŠ¤ ì•ˆë‚´',
                maintenance: 'ì‹œìŠ¤í…œ ì ê²€',
                event: 'ì´ë²¤íŠ¸',
                policy: 'ì •ì±… ë³€ê²½',
                emergency: 'ê¸´ê¸‰ ì•ˆë‚´'
            };
            return texts[category] || category;
        }

        function getLangIcon(lang) {
            const icons = {
                ko: 'ğŸ‡°ğŸ‡·',
                en: 'ğŸ‡ºğŸ‡¸',
                zh: 'ğŸ‡¨ğŸ‡³',
                ja: 'ğŸ‡¯ğŸ‡µ'
            };
            return icons[lang] || '';
        }

        function getLangText(lang) {
            const texts = {
                ko: 'í•œêµ­ì–´',
                en: 'English',
                zh: 'ä¸­æ–‡',
                ja: 'æ—¥æœ¬èª'
            };
            return texts[lang] || lang;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ko-KR', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Initialize
        loadNotice();
    </script>
</body>
</html>
