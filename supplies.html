<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°„ë³‘ìš©í’ˆ - ë‡Œì§ˆí™˜ì¼€ì–´</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ§ </text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="font-sans bg-gray-50">
    <nav class="bg-white shadow-lg fixed w-full top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <a href="index.html" class="flex items-center space-x-3">
                    <span class="text-4xl">ğŸ§ </span>
                    <div><h1 class="text-xl font-bold text-primary">ë‡Œì§ˆí™˜ì¼€ì–´</h1></div>
                </a>
                
                <div class="flex items-center space-x-2">
                    <button onclick="switchLanguage('ko')" class="lang-btn px-2 py-1 rounded-lg hover:bg-gray-100 transition" data-lang="ko">
                        ğŸ‡°ğŸ‡· <span class="hidden sm:inline">í•œêµ­ì–´</span>
                    </button>
                    <button onclick="switchLanguage('en')" class="lang-btn px-2 py-1 rounded-lg hover:bg-gray-100 transition" data-lang="en">
                        ğŸ‡ºğŸ‡¸ <span class="hidden sm:inline">English</span>
                    </button>
                    <button onclick="switchLanguage('zh')" class="lang-btn px-2 py-1 rounded-lg hover:bg-gray-100 transition" data-lang="zh">
                        ğŸ‡¨ğŸ‡³ <span class="hidden sm:inline">ä¸­æ–‡</span>
                    </button>
                    <button onclick="switchLanguage('ja')" class="lang-btn px-2 py-1 rounded-lg hover:bg-gray-100 transition" data-lang="ja">
                        ğŸ‡¯ğŸ‡µ <span class="hidden sm:inline">æ—¥æœ¬èª</span>
                    </button>
                    
                    <!-- Mobile Menu Toggle -->
                    <button id="mobile-menu-toggle" class="md:hidden ml-4 text-gray-600 hover:text-primary">
                        <i class="fas fa-bars text-2xl"></i>
                    </button>
                </div>

            </div>
        </div>
            <!-- Desktop Menu -->
            <div class="hidden md:flex space-x-1 pb-2 overflow-x-auto">
                <a href="index.html" class="menu-link px-3 py-1 text-sm rounded-lg hover:bg-primary hover:text-white transition whitespace-nowrap" data-i18n="menu.home">í™ˆ</a>
                <a href="disease-info.html" class="menu-link px-3 py-1 text-sm rounded-lg hover:bg-primary hover:text-white transition whitespace-nowrap" data-i18n="menu.disease">ë‡Œì§ˆí™˜ ì •ë³´</a>
                <a href="hospital.html" class="menu-link px-3 py-1 text-sm rounded-lg hover:bg-primary hover:text-white transition whitespace-nowrap" data-i18n="menu.hospital">ë³‘ì› ê²€ìƒ‰</a>
                <a href="caregivers.html" class="menu-link px-3 py-1 text-sm rounded-lg hover:bg-primary hover:text-white transition whitespace-nowrap" data-i18n="menu.caregivers">ê°„ë³‘ì¸</a>
                <a href="rehab.html" class="menu-link px-3 py-1 text-sm rounded-lg hover:bg-primary hover:text-white transition whitespace-nowrap" data-i18n="menu.rehab">ì¬í™œìš´ë™</a>
                <a href="insurance.html" class="menu-link px-3 py-1 text-sm rounded-lg hover:bg-primary hover:text-white transition whitespace-nowrap" data-i18n="menu.insurance">ë³´í—˜</a>
                <a href="support.html" class="menu-link px-3 py-1 text-sm rounded-lg hover:bg-primary hover:text-white transition whitespace-nowrap" data-i18n="menu.support">ì§€ì›ì •ì±…</a>
                <a href="supplies.html" class="menu-link px-3 py-1 text-sm rounded-lg bg-primary text-white hover:bg-blue-700 transition whitespace-nowrap" data-i18n="menu.supplies">ê°„ë³‘ìš©í’ˆ</a>
                <a href="medical.html" class="menu-link px-3 py-1 text-sm rounded-lg hover:bg-primary hover:text-white transition whitespace-nowrap" data-i18n="menu.medical">ëª…ì˜ì°¾ê¸°</a>
                <a href="emergency.html" class="menu-link px-3 py-1 text-sm rounded-lg hover:bg-primary hover:text-white transition whitespace-nowrap text-red-600 hover:bg-red-600" data-i18n="menu.emergency">ì‘ê¸‰</a>
            </div>
            
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden md:hidden pb-4">
                <a href="index.html" class="block px-4 py-2 hover:bg-gray-100 rounded-lg" data-i18n="menu.home">í™ˆ</a>
                <a href="disease-info.html" class="block px-4 py-2 hover:bg-gray-100 rounded-lg" data-i18n="menu.disease">ë‡Œì§ˆí™˜ ì •ë³´</a>
                <a href="hospital.html" class="block px-4 py-2 hover:bg-gray-100 rounded-lg" data-i18n="menu.hospital">ë³‘ì› ê²€ìƒ‰</a>
                <a href="caregivers.html" class="block px-4 py-2 hover:bg-gray-100 rounded-lg" data-i18n="menu.caregivers">ê°„ë³‘ì¸</a>
                <a href="rehab.html" class="block px-4 py-2 hover:bg-gray-100 rounded-lg" data-i18n="menu.rehab">ì¬í™œìš´ë™</a>
                <a href="insurance.html" class="block px-4 py-2 hover:bg-gray-100 rounded-lg" data-i18n="menu.insurance">ë³´í—˜</a>
                <a href="support.html" class="block px-4 py-2 hover:bg-gray-100 rounded-lg" data-i18n="menu.support">ì§€ì›ì •ì±…</a>
                <a href="supplies.html" class="block px-4 py-2 hover:bg-gray-100 rounded-lg" data-i18n="menu.supplies">ê°„ë³‘ìš©í’ˆ</a>
                <a href="medical.html" class="block px-4 py-2 hover:bg-gray-100 rounded-lg" data-i18n="menu.medical">ëª…ì˜ì°¾ê¸°</a>
                <a href="emergency.html" class="block px-4 py-2 hover:bg-red-100 text-red-600 rounded-lg" data-i18n="menu.emergency">ì‘ê¸‰</a>
            </div>

        </div>
    </nav>

    <main class="pt-28 pb-16">
        <div class="container mx-auto px-4">
            <div class="text-center mb-12">
                <div class="text-6xl mb-4">ğŸ›’</div>
                <h1 class="text-4xl font-bold text-gray-900 mb-4" data-i18n="page.supplies.title">ê°„ë³‘ìš©í’ˆ</h1>
                <p class="text-xl text-gray-600" data-i18n="page.supplies.subtitle">ê°€ê²©ë¹„êµ ë° ì¤‘ê³ ê±°ë˜</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-cyan-50 border-2 border-cyan-200 rounded-xl p-6">
                    <div class="text-4xl mb-3 text-center">ğŸ›ï¸</div>
                    <h3 class="text-xl font-bold text-center mb-2" data-i18n="supplies.welfare">ë³µì§€ìš©êµ¬</h3>
                    <ul class="text-sm space-y-2">
                        <li>â€¢ ì „ë™ì¹¨ëŒ€</li>
                        <li>â€¢ íœ ì²´ì–´</li>
                        <li>â€¢ ìš•ì°½ì˜ˆë°©ë§¤íŠ¸</li>
                    </ul>
                </div>

                <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-6">
                    <div class="text-4xl mb-3 text-center">ğŸ©²</div>
                    <h3 class="text-xl font-bold text-center mb-2" data-i18n="supplies.hygiene">ìœ„ìƒìš©í’ˆ</h3>
                    <ul class="text-sm space-y-2">
                        <li>â€¢ ì„±ì¸ê¸°ì €ê·€</li>
                        <li>â€¢ ë°©ìˆ˜ë§¤íŠ¸</li>
                        <li>â€¢ ì¼íšŒìš© íŒ¨ë“œ</li>
                    </ul>
                </div>

                <div class="bg-purple-50 border-2 border-purple-200 rounded-xl p-6">
                    <div class="text-4xl mb-3 text-center">ğŸ½ï¸</div>
                    <h3 class="text-xl font-bold text-center mb-2" data-i18n="supplies.dining">ì‹ì‚¬ìš©í’ˆ</h3>
                    <ul class="text-sm space-y-2">
                        <li>â€¢ ê°ë„ ì¡°ì ˆ ìŠ¤í‘¼</li>
                        <li>â€¢ ë¹¨ëŒ€ì»µ</li>
                        <li>â€¢ ë¯¸ë„ëŸ¼ ë°©ì§€ ì‹ê¸°</li>
                    </ul>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                <h2 class="text-2xl font-bold mb-4" data-i18n="supplies.price">ğŸ’° ê°€ê²© ë¹„êµ</h2>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-4 py-3 text-left">í’ˆëª©</th>
                                <th class="px-4 py-3 text-left">ê°€ê²© ë²”ìœ„</th>
                                <th class="px-4 py-3 text-left">ë Œíƒˆ (ì›”)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="border-b">
                                <td class="px-4 py-3">ì„±ì¸ê¸°ì €ê·€</td>
                                <td class="px-4 py-3">â‚©7,000~60,000</td>
                                <td class="px-4 py-3">-</td>
                            </tr>
                            <tr class="border-b">
                                <td class="px-4 py-3">ì „ë™ì¹¨ëŒ€</td>
                                <td class="px-4 py-3">â‚©500,000~2,000,000</td>
                                <td class="px-4 py-3">â‚©70,000~150,000</td>
                            </tr>
                            <tr class="border-b">
                                <td class="px-4 py-3">ìš•ì°½ì˜ˆë°©ë§¤íŠ¸</td>
                                <td class="px-4 py-3">â‚©200,000~800,000</td>
                                <td class="px-4 py-3">â‚©20,000~45,000</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ê±°ë˜ ê²Œì‹œíŒ ì„¹ì…˜ -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-900">ğŸ›ï¸ ì¤‘ê³ ê±°ë˜ ê²Œì‹œíŒ</h2>
                        <p class="text-gray-600 mt-2">ê°„ë³‘ìš©í’ˆì„ ì‚¬ê³ íŒ”ê³  ë‚˜ëˆ ë³´ì„¸ìš”</p>
                    </div>
                    <button onclick="showPostModal()" class="px-6 py-3 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 font-bold">
                        <i class="fas fa-plus mr-2"></i>ê²Œì‹œê¸€ ì‘ì„±
                    </button>
                </div>

                <!-- í•„í„° ë° ê²€ìƒ‰ -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <select id="filter-category" onchange="loadPosts()" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
                        <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
                        <option value="ë³µì§€ìš©êµ¬">ë³µì§€ìš©êµ¬</option>
                        <option value="ìœ„ìƒìš©í’ˆ">ìœ„ìƒìš©í’ˆ</option>
                        <option value="ì‹ì‚¬ìš©í’ˆ">ì‹ì‚¬ìš©í’ˆ</option>
                        <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                    </select>
                    <select id="filter-type" onchange="loadPosts()" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
                        <option value="">ì „ì²´ ìœ í˜•</option>
                        <option value="íŒë§¤">íŒë§¤</option>
                        <option value="êµ¬ë§¤">êµ¬ë§¤</option>
                        <option value="ë Œíƒˆ">ë Œíƒˆ</option>
                        <option value="ë‚˜ëˆ”">ë‚˜ëˆ”</option>
                    </select>
                    <select id="filter-status" onchange="loadPosts()" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
                        <option value="">ì „ì²´ ìƒíƒœ</option>
                        <option value="ê±°ë˜ì¤‘">ê±°ë˜ì¤‘</option>
                        <option value="ì˜ˆì•½ì¤‘">ì˜ˆì•½ì¤‘</option>
                        <option value="ê±°ë˜ì™„ë£Œ">ê±°ë˜ì™„ë£Œ</option>
                    </select>
                    <input type="text" id="search-input" placeholder="ì œëª© ê²€ìƒ‰..." onkeyup="loadPosts()" class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
                </div>

                <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
                <div id="posts-list" class="space-y-4">
                    <!-- Posts will be loaded here -->
                </div>
            </div>

            <!-- ê¸€ì“°ê¸° ëª¨ë‹¬ -->
            <div id="post-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50" style="display: none;">
                <div class="bg-white rounded-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="sticky top-0 bg-white border-b p-6 flex justify-between items-center">
                        <h3 class="text-2xl font-bold">ê²Œì‹œê¸€ ì‘ì„±</h3>
                        <button onclick="closePostModal()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                    </div>
                    <form id="post-form" class="p-6 space-y-4">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">ì¹´í…Œê³ ë¦¬ *</label>
                            <select name="category" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="ë³µì§€ìš©êµ¬">ë³µì§€ìš©êµ¬</option>
                                <option value="ìœ„ìƒìš©í’ˆ">ìœ„ìƒìš©í’ˆ</option>
                                <option value="ì‹ì‚¬ìš©í’ˆ">ì‹ì‚¬ìš©í’ˆ</option>
                                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">ê±°ë˜ ìœ í˜• *</label>
                            <select name="item_type" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="íŒë§¤">íŒë§¤</option>
                                <option value="êµ¬ë§¤">êµ¬ë§¤</option>
                                <option value="ë Œíƒˆ">ë Œíƒˆ</option>
                                <option value="ë‚˜ëˆ”">ë‚˜ëˆ”</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">ì œëª© *</label>
                            <input type="text" name="title" required placeholder="ì˜ˆ: ì „ë™ì¹¨ëŒ€ íŒë§¤í•©ë‹ˆë‹¤" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">ê°€ê²© (ì›)</label>
                            <input type="number" name="price" placeholder="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">ì§€ì—­</label>
                            <input type="text" name="location" placeholder="ì˜ˆ: ì„œìš¸ì‹œ ê°•ë‚¨êµ¬" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">ì‘ì„±ì *</label>
                            <input type="text" name="author" required placeholder="ì´ë¦„ ë˜ëŠ” ë‹‰ë„¤ì„" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">ì—°ë½ì²˜ ì„ íƒ *</label>
                            <div class="grid grid-cols-3 gap-2 mb-2">
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" name="contact_type" value="phone" onchange="toggleContactInput(this)" class="w-4 h-4">
                                    <span>ğŸ“± íœ´ëŒ€í°</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" name="contact_type" value="kakao" onchange="toggleContactInput(this)" class="w-4 h-4">
                                    <span>ğŸ’¬ ì¹´ì¹´ì˜¤í†¡</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer">
                                    <input type="checkbox" name="contact_type" value="email" onchange="toggleContactInput(this)" class="w-4 h-4">
                                    <span>ğŸ“§ ì´ë©”ì¼</span>
                                </label>
                            </div>
                            <input type="text" id="phone-input" name="contact_phone" placeholder="010-1234-5678" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 mb-2 hidden">
                            <input type="text" id="kakao-input" name="contact_kakao" placeholder="ì¹´ì¹´ì˜¤í†¡ ID" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 mb-2 hidden">
                            <input type="email" id="email-input" name="contact_email" placeholder="example@email.com" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 mb-2 hidden">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">ë‚´ìš© *</label>
                            <textarea name="content" required rows="6" placeholder="ìƒí’ˆ ì„¤ëª…ì„ ìì„¸íˆ ì‘ì„±í•´ì£¼ì„¸ìš”" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500"></textarea>
                        </div>
                        <div class="flex gap-4">
                            <button type="submit" class="flex-1 px-6 py-3 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 font-bold">
                                <i class="fas fa-check mr-2"></i>ì‘ì„±í•˜ê¸°
                            </button>
                            <button type="button" onclick="closePostModal()" class="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 font-bold">
                                ì·¨ì†Œ
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
            <div id="detail-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50" style="display: none;">
                <div class="bg-white rounded-xl max-w-3xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                    <div class="sticky top-0 bg-white border-b p-6 flex justify-between items-center">
                        <h3 id="detail-title" class="text-2xl font-bold"></h3>
                        <button onclick="closeDetailModal()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                    </div>
                    <div id="detail-content" class="p-6">
                        <!-- Post details will be loaded here -->
                    </div>
                    <div class="border-t p-6">
                        <h4 class="text-xl font-bold mb-4">ğŸ’¬ ë‹µë³€ (<span id="reply-count">0</span>)</h4>
                        <div id="replies-list" class="space-y-4 mb-6">
                            <!-- Replies will be loaded here -->
                        </div>
                        <form id="reply-form" class="space-y-4">
                            <input type="hidden" name="post_id" id="reply-post-id">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">ì´ë¦„</label>
                                <input type="text" name="author" required placeholder="ì´ë¦„ ë˜ëŠ” ë‹‰ë„¤ì„" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">ë‹µë³€</label>
                                <textarea name="content" required rows="3" placeholder="ë‹µë³€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500"></textarea>
                            </div>
                            <button type="submit" class="w-full px-6 py-3 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 font-bold">
                                <i class="fas fa-reply mr-2"></i>ë‹µë³€ ì‘ì„±
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-900 text-white py-8">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 ë‡Œì§ˆí™˜ì¼€ì–´. ëª¨ë“  ê¶Œë¦¬ ë³´ìœ </p>
        </div>
    </footer>

    <script src="js/i18n.js"></script>
    <script src="js/main.js"></script>
    <script>
        let currentPostId = null;

        // ê²Œì‹œê¸€ ëª©ë¡ ë¡œë“œ
        async function loadPosts() {
            try {
                const category = document.getElementById('filter-category').value;
                const type = document.getElementById('filter-type').value;
                const status = document.getElementById('filter-status').value;
                const search = document.getElementById('search-input').value;

                const response = await fetch('tables/supply_posts?limit=100&sort=-created_at');
                const data = await response.json();
                let posts = data.data || [];

                // í•„í„°ë§
                if (category) posts = posts.filter(p => p.category === category);
                if (type) posts = posts.filter(p => p.item_type === type);
                if (status) posts = posts.filter(p => p.status === status);
                if (search) posts = posts.filter(p => p.title.toLowerCase().includes(search.toLowerCase()));

                renderPosts(posts);
            } catch (error) {
                console.error('Error loading posts:', error);
                document.getElementById('posts-list').innerHTML = '<div class="text-center py-12 text-gray-600">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }

        function renderPosts(posts) {
            const container = document.getElementById('posts-list');
            
            if (posts.length === 0) {
                container.innerHTML = '<div class="text-center py-12 text-gray-600">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ ê²Œì‹œê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</div>';
                return;
            }

            container.innerHTML = posts.map(post => {
                const typeColors = {
                    'íŒë§¤': 'bg-blue-100 text-blue-700',
                    'êµ¬ë§¤': 'bg-green-100 text-green-700',
                    'ë Œíƒˆ': 'bg-purple-100 text-purple-700',
                    'ë‚˜ëˆ”': 'bg-pink-100 text-pink-700'
                };
                const statusColors = {
                    'ê±°ë˜ì¤‘': 'bg-green-500 text-white',
                    'ì˜ˆì•½ì¤‘': 'bg-yellow-500 text-white',
                    'ê±°ë˜ì™„ë£Œ': 'bg-gray-500 text-white'
                };
                
                return `
                    <div onclick="showDetail('${post.id}')" class="bg-gray-50 rounded-xl p-6 hover:bg-gray-100 transition cursor-pointer">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex items-center gap-2">
                                <span class="px-3 py-1 ${typeColors[post.item_type] || 'bg-gray-100 text-gray-700'} rounded-full text-sm font-bold">${post.item_type}</span>
                                <span class="px-3 py-1 ${statusColors[post.status] || 'bg-gray-100 text-gray-700'} rounded-full text-sm font-bold">${post.status}</span>
                                <span class="px-3 py-1 bg-gray-200 text-gray-700 rounded-full text-sm">${post.category}</span>
                            </div>
                            <div class="text-right">
                                ${post.price > 0 ? `<div class="text-xl font-bold text-cyan-600">${post.price.toLocaleString()}ì›</div>` : '<div class="text-lg font-bold text-green-600">ë¬´ë£Œ ë‚˜ëˆ”</div>'}
                            </div>
                        </div>
                        <h3 class="text-xl font-bold text-gray-900 mb-2">${post.title}</h3>
                        <p class="text-gray-600 mb-3 line-clamp-2">${post.content}</p>
                        <div class="flex items-center justify-between text-sm text-gray-500">
                            <div class="flex items-center gap-4">
                                <span><i class="fas fa-user mr-1"></i>${post.author}</span>
                                ${post.location ? `<span><i class="fas fa-map-marker-alt mr-1"></i>${post.location}</span>` : ''}
                                <span><i class="fas fa-eye mr-1"></i>${post.views || 0}</span>
                                <span><i class="fas fa-comment mr-1"></i>${post.reply_count || 0}</span>
                            </div>
                            <div class="flex items-center gap-3 mt-2">
                                <button onclick="event.stopPropagation(); likePost('${post.id}')" class="flex items-center gap-1 text-blue-600 hover:text-blue-700">
                                    <i class="fas fa-thumbs-up"></i>
                                    <span id="like-${post.id}">${post.likes || 0}</span>
                                </button>
                                <button onclick="event.stopPropagation(); dislikePost('${post.id}')" class="flex items-center gap-1 text-red-600 hover:text-red-700">
                                    <i class="fas fa-thumbs-down"></i>
                                    <span id="dislike-${post.id}">${post.dislikes || 0}</span>
                                </button>
                            </div>
                            <span>${new Date(post.created_at).toLocaleDateString()}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°
        async function showDetail(postId) {
            try {
                currentPostId = postId;
                
                // ê²Œì‹œê¸€ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const postResponse = await fetch(`tables/supply_posts/${postId}`);
                const post = await postResponse.json();

                // ì¡°íšŒìˆ˜ ì¦ê°€
                await fetch(`tables/supply_posts/${postId}`, {
                    method: 'PATCH',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ views: (post.views || 0) + 1 })
                });

                // ë‹µë³€ ê°€ì ¸ì˜¤ê¸°
                const repliesResponse = await fetch('tables/supply_replies?limit=100');
                const repliesData = await repliesResponse.json();
                const replies = (repliesData.data || []).filter(r => r.post_id === postId);

                // UI ì—…ë°ì´íŠ¸
                document.getElementById('detail-title').textContent = post.title;
                document.getElementById('reply-post-id').value = postId;
                document.getElementById('reply-count').textContent = replies.length;

                const typeColors = {
                    'íŒë§¤': 'bg-blue-100 text-blue-700',
                    'êµ¬ë§¤': 'bg-green-100 text-green-700',
                    'ë Œíƒˆ': 'bg-purple-100 text-purple-700',
                    'ë‚˜ëˆ”': 'bg-pink-100 text-pink-700'
                };
                const statusColors = {
                    'ê±°ë˜ì¤‘': 'bg-green-500 text-white',
                    'ì˜ˆì•½ì¤‘': 'bg-yellow-500 text-white',
                    'ê±°ë˜ì™„ë£Œ': 'bg-gray-500 text-white'
                };

                document.getElementById('detail-content').innerHTML = `
                    <div class="space-y-4">
                        <div class="flex items-center gap-2 mb-4">
                            <span class="px-3 py-1 ${typeColors[post.item_type] || 'bg-gray-100'} rounded-full text-sm font-bold">${post.item_type}</span>
                            <span class="px-3 py-1 ${statusColors[post.status] || 'bg-gray-100'} rounded-full text-sm font-bold">${post.status}</span>
                            <span class="px-3 py-1 bg-gray-200 text-gray-700 rounded-full text-sm">${post.category}</span>
                        </div>
                        ${post.price > 0 ? `<div class="text-3xl font-bold text-cyan-600 mb-4">${post.price.toLocaleString()}ì›</div>` : '<div class="text-2xl font-bold text-green-600 mb-4">ë¬´ë£Œ ë‚˜ëˆ”</div>'}
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="flex items-center justify-between text-sm text-gray-600">
                                <div class="flex items-center gap-4">
                                    <span><i class="fas fa-user mr-1"></i>${post.author}</span>
                                    ${post.location ? `<span><i class="fas fa-map-marker-alt mr-1"></i>${post.location}</span>` : ''}
                                </div>
                                <div>
                                    <span class="mr-3"><i class="fas fa-eye mr-1"></i>${post.views || 0}</span>
                                    <span>${new Date(post.created_at).toLocaleString()}</span>
                                </div>
                            </div>
                        </div>
                        <div class="prose max-w-none">
                            <p class="text-gray-700 whitespace-pre-wrap">${post.content}</p>
                        </div>
                        ${post.contact_phone || post.contact_kakao || post.contact_email ? `
                        <div class="bg-blue-50 rounded-lg p-4 mt-4">
                            <h4 class="font-bold mb-2">ğŸ“ ì—°ë½ì²˜</h4>
                            <div class="space-y-1 text-sm">
                                ${post.contact_phone ? `<p>ğŸ“± íœ´ëŒ€í°: ${post.contact_phone}</p>` : ''}
                                ${post.contact_kakao ? `<p>ğŸ’¬ ì¹´ì¹´ì˜¤í†¡: ${post.contact_kakao}</p>` : ''}
                                ${post.contact_email ? `<p>ğŸ“§ ì´ë©”ì¼: ${post.contact_email}</p>` : ''}
                            </div>
                        </div>
                        ` : ''}
                        <div class="flex items-center gap-6 mt-4 pt-4 border-t">
                            <button onclick="likePost('${postId}')" class="flex items-center gap-2 text-blue-600 hover:text-blue-700 font-bold">
                                <i class="fas fa-thumbs-up text-xl"></i>
                                <span>ì¢‹ì•„ìš” <span id="like-${postId}">${post.likes || 0}</span></span>
                            </button>
                            <button onclick="dislikePost('${postId}')" class="flex items-center gap-2 text-red-600 hover:text-red-700 font-bold">
                                <i class="fas fa-thumbs-down text-xl"></i>
                                <span>ì‹«ì–´ìš” <span id="dislike-${postId}">${post.dislikes || 0}</span></span>
                            </button>
                        </div>
                        <div class="flex gap-2 pt-4">
                            <button onclick="updatePostStatus('${postId}', 'ê±°ë˜ì¤‘')" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 text-sm">ê±°ë˜ì¤‘ìœ¼ë¡œ ë³€ê²½</button>
                            <button onclick="updatePostStatus('${postId}', 'ì˜ˆì•½ì¤‘')" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 text-sm">ì˜ˆì•½ì¤‘ìœ¼ë¡œ ë³€ê²½</button>
                            <button onclick="updatePostStatus('${postId}', 'ê±°ë˜ì™„ë£Œ')" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 text-sm">ê±°ë˜ì™„ë£Œë¡œ ë³€ê²½</button>
                        </div>
                    </div>
                `;

                renderReplies(replies);
                
                document.getElementById('detail-modal').style.display = 'flex';
            } catch (error) {
                console.error('Error loading post detail:', error);
                alert('ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        function renderReplies(replies) {
            const container = document.getElementById('replies-list');
            
            if (replies.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500">ì•„ì§ ë‹µë³€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            container.innerHTML = replies.map(reply => `
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-bold text-gray-900">${reply.author}</span>
                        <span class="text-sm text-gray-500">${new Date(reply.created_at).toLocaleString()}</span>
                    </div>
                    <p class="text-gray-700 whitespace-pre-wrap">${reply.content}</p>
                </div>
            `).join('');
        }

        // ì—°ë½ì²˜ ì…ë ¥ í† ê¸€
        function toggleContactInput(checkbox) {
            const inputId = checkbox.value + '-input';
            const input = document.getElementById(inputId);
            if (checkbox.checked) {
                input.classList.remove('hidden');
            } else {
                input.classList.add('hidden');
                input.value = '';
            }
        }

        // ì¢‹ì•„ìš”
        async function likePost(postId) {
            try {
                const response = await fetch(`tables/supply_posts/${postId}`);
                const post = await response.json();
                await fetch(`tables/supply_posts/${postId}`, {
                    method: 'PATCH',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ likes: (post.likes || 0) + 1 })
                });
                document.getElementById(`like-${postId}`).textContent = (post.likes || 0) + 1;
            } catch (error) {
                console.error('Error liking post:', error);
            }
        }

        // ì‹«ì–´ìš”
        async function dislikePost(postId) {
            try {
                const response = await fetch(`tables/supply_posts/${postId}`);
                const post = await response.json();
                await fetch(`tables/supply_posts/${postId}`, {
                    method: 'PATCH',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ dislikes: (post.dislikes || 0) + 1 })
                });
                document.getElementById(`dislike-${postId}`).textContent = (post.dislikes || 0) + 1;
            } catch (error) {
                console.error('Error disliking post:', error);
            }
        }

        // ê²Œì‹œê¸€ ì‘ì„±
        document.getElementById('post-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const postData = {
                title: formData.get('title'),
                content: formData.get('content'),
                author: formData.get('author'),
                category: formData.get('category'),
                item_type: formData.get('item_type'),
                price: parseInt(formData.get('price')) || 0,
                location: formData.get('location') || '',
                contact_phone: formData.get('contact_phone') || '',
                contact_kakao: formData.get('contact_kakao') || '',
                contact_email: formData.get('contact_email') || '',
                status: 'ê±°ë˜ì¤‘',
                views: 0,
                reply_count: 0,
                likes: 0,
                dislikes: 0
            };

            try {
                await fetch('tables/supply_posts', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(postData)
                });

                alert('ê²Œì‹œê¸€ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
                closePostModal();
                e.target.reset();
                loadPosts();
            } catch (error) {
                console.error('Error creating post:', error);
                alert('ê²Œì‹œê¸€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        });

        // ë‹µë³€ ì‘ì„±
        document.getElementById('reply-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const replyData = {
                post_id: formData.get('post_id'),
                content: formData.get('content'),
                author: formData.get('author')
            };

            try {
                await fetch('tables/supply_replies', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(replyData)
                });

                // ê²Œì‹œê¸€ì˜ ë‹µë³€ ìˆ˜ ì—…ë°ì´íŠ¸
                const postResponse = await fetch(`tables/supply_posts/${currentPostId}`);
                const post = await postResponse.json();
                await fetch(`tables/supply_posts/${currentPostId}`, {
                    method: 'PATCH',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ reply_count: (post.reply_count || 0) + 1 })
                });

                alert('ë‹µë³€ì´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
                e.target.reset();
                showDetail(currentPostId); // ìƒˆë¡œê³ ì¹¨
            } catch (error) {
                console.error('Error creating reply:', error);
                alert('ë‹µë³€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        });

        // ê²Œì‹œê¸€ ìƒíƒœ ì—…ë°ì´íŠ¸
        async function updatePostStatus(postId, status) {
            try {
                await fetch(`tables/supply_posts/${postId}`, {
                    method: 'PATCH',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ status: status })
                });
                alert(`ìƒíƒœê°€ "${status}"ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                showDetail(postId);
                loadPosts();
            } catch (error) {
                console.error('Error updating status:', error);
                alert('ìƒíƒœ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜
        function showPostModal() {
            document.getElementById('post-modal').style.display = 'flex';
        }

        function closePostModal() {
            document.getElementById('post-modal').style.display = 'none';
        }

        function closeDetailModal() {
            document.getElementById('detail-modal').style.display = 'none';
            currentPostId = null;
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        document.getElementById('post-modal').addEventListener('click', function(e) {
            if (e.target === this) closePostModal();
        });

        document.getElementById('detail-modal').addEventListener('click', function(e) {
            if (e.target === this) closeDetailModal();
        });

        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closePostModal();
                closeDetailModal();
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê²Œì‹œê¸€ ëª©ë¡ ë¡œë“œ
        document.addEventListener('DOMContentLoaded', loadPosts);
    </script>
</body>
</html>