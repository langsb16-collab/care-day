<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Upload Test - CASHiQ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <div class="bg-white rounded-xl shadow-lg p-6 max-w-2xl mx-auto">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">
                <i class="fas fa-video text-red-600 mr-2"></i>
                ë™ì˜ìƒ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸
            </h1>
            
            <div class="space-y-6">
                <!-- Test Status -->
                <div id="testStatus" class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h2 class="font-bold text-blue-800 mb-2">
                        <i class="fas fa-info-circle mr-2"></i>í…ŒìŠ¤íŠ¸ ìƒíƒœ
                    </h2>
                    <div id="statusMessages" class="space-y-1 text-sm text-gray-700">
                        <p>âœ“ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ</p>
                    </div>
                </div>

                <!-- Video File Input Test -->
                <div class="border border-gray-300 rounded-lg p-4">
                    <h2 class="font-bold text-gray-800 mb-3">
                        <i class="fas fa-upload mr-2"></i>íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸
                    </h2>
                    
                    <input type="file" id="videoFile" accept="video/*" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 
                                  file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 
                                  file:text-sm file:font-semibold file:bg-red-50 file:text-red-700 
                                  hover:file:bg-red-100">
                    <p class="mt-2 text-xs text-gray-500">MP4, WebM, AVI í˜•ì‹ ì§€ì› (ìµœëŒ€ 10MB)</p>
                    
                    <div id="fileInfo" class="mt-4 hidden bg-green-50 border border-green-200 rounded p-3">
                        <h3 class="font-semibold text-green-800 mb-2">ì„ íƒëœ íŒŒì¼:</h3>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li><strong>íŒŒì¼ëª…:</strong> <span id="fileName"></span></li>
                            <li><strong>í¬ê¸°:</strong> <span id="fileSize"></span></li>
                            <li><strong>íƒ€ì…:</strong> <span id="fileType"></span></li>
                        </ul>
                    </div>

                    <div id="videoPreview" class="mt-4 hidden">
                        <h3 class="font-semibold text-gray-800 mb-2">ë¯¸ë¦¬ë³´ê¸°:</h3>
                        <video id="previewVideo" class="max-w-md rounded-lg shadow-md" controls>
                            <source id="videoSource" type="video/mp4">
                            ë¸Œë¼ìš°ì €ê°€ ë™ì˜ìƒì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                        </video>
                    </div>
                </div>

                <!-- Console Log Display -->
                <div class="border border-gray-300 rounded-lg p-4">
                    <h2 class="font-bold text-gray-800 mb-3">
                        <i class="fas fa-terminal mr-2"></i>ì½˜ì†” ë¡œê·¸
                    </h2>
                    <div id="consoleLog" class="bg-gray-900 text-green-400 font-mono text-xs p-3 rounded max-h-60 overflow-y-auto">
                        <p>> Test page loaded successfully</p>
                    </div>
                </div>

                <!-- Test Instructions -->
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <h2 class="font-bold text-yellow-800 mb-2">
                        <i class="fas fa-clipboard-list mr-2"></i>í…ŒìŠ¤íŠ¸ ë°©ë²•
                    </h2>
                    <ol class="list-decimal list-inside text-sm text-gray-700 space-y-1">
                        <li>ìœ„ì˜ íŒŒì¼ ì„ íƒ ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤</li>
                        <li>10MB ì´í•˜ì˜ ë™ì˜ìƒ íŒŒì¼ì„ ì„ íƒí•©ë‹ˆë‹¤ (ê¶Œì¥: 1-5MB)</li>
                        <li>íŒŒì¼ ì •ë³´ê°€ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤</li>
                        <li>ë™ì˜ìƒ ë¯¸ë¦¬ë³´ê¸°ê°€ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤</li>
                        <li>ì½˜ì†” ë¡œê·¸ì—ì„œ ì˜¤ë¥˜ê°€ ì—†ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤</li>
                    </ol>
                </div>

                <!-- Browser Info -->
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                    <h2 class="font-bold text-purple-800 mb-2">
                        <i class="fas fa-browser mr-2"></i>ë¸Œë¼ìš°ì € ì •ë³´
                    </h2>
                    <div class="text-sm text-gray-700 space-y-1">
                        <p><strong>User Agent:</strong> <span id="userAgent" class="text-xs break-all"></span></p>
                        <p><strong>Platform:</strong> <span id="platform"></span></p>
                        <p><strong>Language:</strong> <span id="language"></span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Logging function
        function log(message, type = 'info') {
            const consoleLog = document.getElementById('consoleLog');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'ğŸ“';
            const color = type === 'error' ? 'text-red-400' : type === 'success' ? 'text-green-400' : 'text-blue-400';
            
            const line = document.createElement('p');
            line.className = color;
            line.textContent = `[${timestamp}] ${icon} ${message}`;
            consoleLog.appendChild(line);
            consoleLog.scrollTop = consoleLog.scrollHeight;
            
            console.log(message);
        }

        // Status update function
        function updateStatus(message) {
            const statusMessages = document.getElementById('statusMessages');
            const p = document.createElement('p');
            p.textContent = message;
            statusMessages.appendChild(p);
        }

        // Initialize
        log('Initializing test page...');
        
        // Display browser info
        document.getElementById('userAgent').textContent = navigator.userAgent;
        document.getElementById('platform').textContent = navigator.platform;
        document.getElementById('language').textContent = navigator.language;
        
        log('Browser info loaded', 'success');

        // Check if video element is supported
        const video = document.createElement('video');
        const canPlayMP4 = video.canPlayType('video/mp4');
        const canPlayWebM = video.canPlayType('video/webm');
        
        log(`Video support - MP4: ${canPlayMP4}, WebM: ${canPlayWebM}`, 'info');
        updateStatus(`âœ“ ë™ì˜ìƒ ì§€ì›: MP4 (${canPlayMP4}), WebM (${canPlayWebM})`);

        // Check FileReader API
        if (window.FileReader) {
            log('FileReader API available', 'success');
            updateStatus('âœ“ FileReader API ì§€ì›');
        } else {
            log('FileReader API NOT available', 'error');
            updateStatus('âœ— FileReader API ë¯¸ì§€ì›');
        }

        // Video file input handler
        const videoFileInput = document.getElementById('videoFile');
        
        if (videoFileInput) {
            log('Video file input element found', 'success');
            updateStatus('âœ“ íŒŒì¼ ì…ë ¥ ìš”ì†Œ ë°œê²¬');
            
            videoFileInput.addEventListener('change', function(e) {
                log('File input change event triggered', 'success');
                
                const file = e.target.files[0];
                if (file) {
                    log(`File selected: ${file.name}`, 'success');
                    
                    // Display file info
                    document.getElementById('fileName').textContent = file.name;
                    document.getElementById('fileSize').textContent = (file.size / 1024 / 1024).toFixed(2) + ' MB';
                    document.getElementById('fileType').textContent = file.type;
                    document.getElementById('fileInfo').classList.remove('hidden');
                    
                    updateStatus(`âœ“ íŒŒì¼ ì„ íƒ: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`);
                    
                    // Check file size
                    const maxSize = 10 * 1024 * 1024; // 10MB
                    if (file.size > maxSize) {
                        log(`File too large: ${(file.size / 1024 / 1024).toFixed(2)} MB (max 10MB)`, 'error');
                        alert('íŒŒì¼ í¬ê¸°ê°€ 10MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.');
                        this.value = '';
                        return;
                    }
                    
                    // Read and preview video
                    log('Reading file...', 'info');
                    const reader = new FileReader();
                    
                    reader.onload = function(event) {
                        log('File read successfully', 'success');
                        updateStatus('âœ“ íŒŒì¼ ì½ê¸° ì™„ë£Œ');
                        
                        try {
                            const videoUrl = event.target.result;
                            const videoSize = videoUrl.length;
                            
                            log(`Base64 size: ${(videoSize / 1024 / 1024).toFixed(2)} MB`, 'info');
                            
                            // Show preview
                            const videoSource = document.getElementById('videoSource');
                            const previewVideo = document.getElementById('previewVideo');
                            
                            videoSource.src = videoUrl;
                            videoSource.type = file.type;
                            previewVideo.load();
                            
                            document.getElementById('videoPreview').classList.remove('hidden');
                            
                            log('Video preview loaded', 'success');
                            updateStatus('âœ“ ë™ì˜ìƒ ë¯¸ë¦¬ë³´ê¸° ì¤€ë¹„ ì™„ë£Œ');
                            
                            // Test localStorage
                            try {
                                const testKey = '_video_upload_test_' + Date.now();
                                localStorage.setItem(testKey, videoUrl);
                                localStorage.removeItem(testKey);
                                log('localStorage test passed', 'success');
                                updateStatus('âœ“ localStorage ì €ì¥ í…ŒìŠ¤íŠ¸ ì„±ê³µ');
                            } catch (storageError) {
                                log('localStorage test FAILED: ' + storageError.message, 'error');
                                updateStatus('âœ— localStorage ì €ì¥ ì‹¤íŒ¨ (ìš©ëŸ‰ ë¶€ì¡± ê°€ëŠ¥ì„±)');
                            }
                            
                        } catch (error) {
                            log('Error processing video: ' + error.message, 'error');
                            updateStatus('âœ— ë™ì˜ìƒ ì²˜ë¦¬ ì˜¤ë¥˜');
                        }
                    };
                    
                    reader.onerror = function(error) {
                        log('FileReader error: ' + error, 'error');
                        updateStatus('âœ— íŒŒì¼ ì½ê¸° ì˜¤ë¥˜');
                    };
                    
                    reader.readAsDataURL(file);
                    
                } else {
                    log('No file selected', 'info');
                }
            });
            
            log('Event listener attached successfully', 'success');
            updateStatus('âœ“ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²° ì™„ë£Œ');
            
        } else {
            log('Video file input element NOT found', 'error');
            updateStatus('âœ— íŒŒì¼ ì…ë ¥ ìš”ì†Œ ë¯¸ë°œê²¬ (ì˜¤ë¥˜!)');
        }

        log('Test page initialization complete', 'success');
        updateStatus('âœ“ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
    </script>
</body>
</html>
